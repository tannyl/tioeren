{
  "name": "Tiøren",
  "build": {
    "dockerfile": "Dockerfile"
  },
  "workspaceFolder": "/workspace",
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached",

  "runArgs": ["--init", "--privileged"],

  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "dockerDashComposeVersion": "v2",
      "moby": false
    },
    "ghcr.io/devcontainers/features/node:1": {
      "version": "lts"
    },
    "ghcr.io/devcontainers/features/common-utils:2": {},
    "ghcr.io/devcontainers/features/git:1": {
      "ppa": false,
      "version": "latest"
    },
    "ghcr.io/devcontainers/features/github-cli:1": {
      "installDirectlyFromGitHubRelease": true,
      "version": "latest"
    }
  },

  "mounts": [
    "source=tioren-docker-data,target=/var/lib/docker,type=volume",
    "source=tioren-vscode-server,target=/root/.vscode-server,type=volume",
    "source=tioren-claude-data,target=/root/.claude,type=volume",
    "source=tioren-node-modules,target=/workspace/ui/node_modules,type=volume"
  ],

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.black-formatter",
        "esbenp.prettier-vscode",
        "dbaeumer.vscode-eslint",
        "svelte.svelte-vscode",
        "mtxr.sqltools",
        "mtxr.sqltools-driver-pg",
        "humao.rest-client",
        "eamodio.gitlens",
        "anthropic.claude-code"
      ],
      "settings": {
        "git.enabled": true,
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "editor.formatOnSave": true,
        "[python]": {
          "editor.defaultFormatter": "ms-python.black-formatter"
        },
        "[javascript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[typescript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[svelte]": {
          "editor.defaultFormatter": "svelte.svelte-vscode"
        },
        "sqltools.connections": [
          {
            "name": "Tiøren DB",
            "driver": "PostgreSQL",
            "server": "localhost",
            "port": 5432,
            "database": "tioeren",
            "username": "tioeren",
            "password": "tioeren"
          }
        ]
      }
    }
  },

  "forwardPorts": [80, 443, 3000, 5173, 8000, 5432],

  "postCreateCommand": "pip install -r requirements-dev.txt && pip install -e '.[security]' && cd /workspace/ui && npm install && npx -y playwright install-deps chromium",

  "remoteUser": "root"
}